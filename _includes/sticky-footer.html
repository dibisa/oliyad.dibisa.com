<div class="sticky-footer" id="sticky-footer">
  <div class="site-card-bar">
    <div class="bar-left">
      <img class="bar-avatar" src="{{ site.profile_image | default: '/assets/img/profile.svg' }}" alt="avatar" />
      <div class="bar-identity">
        <div class="bar-name">{{ site.title }}</div>
        <div class="bar-email">{{ site.email }}</div>
      </div>
    </div>

    <div class="bar-actions">
      <button class="bar-toggle footer-toggle" aria-expanded="false"><span class="chev">â–¾</span></button>
    </div>
  </div>

  <div class="site-card-content">
    <div class="footer-inner">
      <div class="col-photo footer-col">
        <img class="footer-avatar" src="{{ site.profile_image | default: '/assets/img/profile.svg' }}" alt="photo" />
      </div>

      <div class="col-identity footer-col">
        <div class="identity-name">{{ site.title }}</div>
        <div class="identity-email">{{ site.email }}</div>
        <div class="identity-signature">
          <div class="sig-title">{{ site.signature_title }}</div>
          <div class="sig-affil">{{ site.signature_affiliation }}</div>
          <div class="sig-location">{{ site.signature_location }}</div>
        </div>
      </div>

      <div class="col-social footer-col">
        <strong>Profiles</strong>
        <ul class="social-list">
          {% for s in site.social_links %}
            <li><a href="{{ s.url }}" target="_blank" rel="noopener">{{ s.label }}</a></li>
          {% endfor %}
        </ul>
      </div>

      <div class="col-summary footer-col footer-desc">
        <p>{{ site.phd_summary }}</p>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  const footer = document.getElementById('sticky-footer');
  if (!footer) return;

  const toggle = footer.querySelector('.footer-toggle');
  const isMobile = window.innerWidth <= 640;

  function updatePadding() {
    const h = footer.offsetHeight;
    document.documentElement.style.setProperty('--footer-h', h + 'px');
    document.body.style.paddingBottom = h + 'px';
  }

  function setOpen(open) {
    footer.classList.toggle('site-card-open', open);
    if (toggle) toggle.setAttribute('aria-expanded', open);
    localStorage.setItem('footerOpen', open ? '1' : '0');
    updatePadding();
  }

  // Toggle on click
  if (toggle) {
    toggle.addEventListener('click', function() {
      setOpen(!footer.classList.contains('site-card-open'));
    });
  }

  // Initial state: mobile collapsed, desktop expanded
  const stored = localStorage.getItem('footerOpen');
  if (stored !== null) {
    setOpen(stored === '1');
  } else {
    setOpen(!isMobile);
  }

  window.addEventListener('resize', updatePadding);
  updatePadding();
})();
</script>
