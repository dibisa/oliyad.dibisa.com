---
layout: default
---

<div class="home">
  <header style="margin: 1.5rem 0 1rem 0;">
    <h1 style="margin-bottom: 0.25rem;">{{ site.title }}</h1>
    <p style="margin-top: 0; max-width: 70ch;">
      {{ site.description }}
    </p>
  </header>

  {% include project-carousel.html %}

  <hr style="margin: 2rem 0;" />

  <h2>Selected Projects & Papers</h2>

  <div class="projects-grid" style="display: grid; grid-template-columns: repeat(3, minmax(280px, 1fr)); gap: 1rem;">
    {% for p in site.data.projects %}
      {% assign idx = forloop.index0 %}
      <div class="project-card" style="border: 1px solid #e5e5e5; border-radius: 12px; padding: 1rem;">
        <a href="{{ p.paper_url }}" target="_blank" rel="noopener" style="text-decoration: none;">
          <h3 style="margin-top: 0.25rem;">{{ p.title }}</h3>
        </a>

        <div class="project-media" id="project-media-{{ idx }}">
          {% assign media_items = p.media %}
          {% if media_items and media_items.size > 0 %}
            {% assign first = media_items[0] %}
            {% if first.type == 'video' %}
              <video src="{{ first.src }}" controls style="width:100%; border-radius:12px;"></video>
            {% else %}
              <img src="{{ first.src }}" alt="{{ first.caption | default: p.title }}" style="width:100%; border-radius:12px;" />
            {% endif %}

            {% if media_items.size > 1 %}
              <div class="project-media-controls" style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                <button class="p-prev" data-idx="{{ idx }}">◀</button>
                <button class="p-next" data-idx="{{ idx }}">▶</button>
              </div>
            {% endif %}
          {% else %}
            <img src="{{ site.media_placeholder | default: '/assets/media/placeholder.svg' }}" alt="placeholder" style="width:100%; border-radius:12px;" />
          {% endif %}
        </div>

        <p style="margin: 0.5rem 0;">{{ p.blurb }}</p>

        <div style="font-size: 0.9rem; opacity: 0.9;">
          {% for t in p.tags %}
            <span style="display: inline-block; margin-right: 0.5rem;">#{{ t }}</span>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
  // inner media carousel for project cards
  document.addEventListener('DOMContentLoaded', function(){
    const projects = {{ site.data.projects | jsonify }};

    function showMedia(idx, pos){
      const p = projects[idx];
      const items = p.media || [];
      if(!items || items.length === 0) return;
      const item = items[pos];
      const container = document.getElementById('project-media-' + idx);
      if(!container) return;
      container.innerHTML = '';
      if(item.type === 'video'){
        const v = document.createElement('video');
        v.src = item.src;
        v.controls = true;
        v.style.width = '100%';
        v.style.borderRadius = '12px';
        container.appendChild(v);
      } else {
        const img = document.createElement('img');
        img.src = item.src;
        img.alt = item.caption || '';
        img.style.width = '100%';
        img.style.borderRadius = '12px';
        container.appendChild(img);
      }
      // if more than 1, append controls
      if(items.length > 1){
        const controls = document.createElement('div');
        controls.className = 'project-media-controls';
        controls.style.display = 'flex';
        controls.style.gap = '0.5rem';
        controls.style.marginTop = '0.5rem';
        const prev = document.createElement('button'); prev.textContent='◀'; prev.className='p-prev'; prev.dataset.idx=idx; prev.dataset.pos = pos;
        const next = document.createElement('button'); next.textContent='▶'; next.className='p-next'; next.dataset.idx=idx; next.dataset.pos = pos;
        controls.appendChild(prev); controls.appendChild(next);
        container.appendChild(controls);
      }
    }

    // track positions
    const positions = [];
    for(let i=0;i<projects.length;i++) positions[i]=0;

    document.body.addEventListener('click', function(e){
      if(e.target.matches('.p-next')){
        const idx = parseInt(e.target.dataset.idx);
        const p = projects[idx]; if(!p) return;
        const len = (p.media || []).length;
        positions[idx] = (positions[idx] + 1) % len;
        showMedia(idx, positions[idx]);
      }
      if(e.target.matches('.p-prev')){
        const idx = parseInt(e.target.dataset.idx);
        const p = projects[idx]; if(!p) return;
        const len = (p.media || []).length;
        positions[idx] = (positions[idx] - 1 + len) % len;
        showMedia(idx, positions[idx]);
      }
    });

    // initialize all with pos 0
    for(let i=0;i<projects.length;i++){
      showMedia(i, 0);
    }
  });
</script>
